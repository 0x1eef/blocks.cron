#!/bin/sh -e

##
# environment
export HOME="/home/_blocks"
export PATH="/usr/bin:/usr/local/bin:/sbin"

##
# variables
# shellcheck source=/dev/null
. "${HOME}/.local/sh/today.sh"
path="${HOME}/blocks/$(today)"
libexec="${HOME}/.local/libexec"
blocks=$(which blocks)
doas=$(which doas)

##
# main
"${blocks}" get
"${blocks}" emit > "${path}"
"${doas}" -n -u root -- "${libexec}"/copy
"${doas}" -n -u root -- "${libexec}"/reload
