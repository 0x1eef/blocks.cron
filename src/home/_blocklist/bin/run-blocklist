#!/bin/sh -e

##
# environment
export HOME="/home/_blocklist"
export PATH="/usr/bin:/usr/local/bin:${PATH}"

##
# setup
# shellcheck source=/dev/null
. "${HOME}/.local/sh/today.sh"
path="${HOME}/blocks/$(today)"
libexec="${HOME}/.local/libexec"
blocklist=$(which blocklist)
doas=$(which doas)

##
# main
"${blocklist}" download
"${blocklist}" emit > "${path}"
"${doas}" -u root "${libexec}"/copy
"${doas}" -u root "${libexec}"/reload
